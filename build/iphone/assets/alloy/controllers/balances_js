var Alloy=require('/alloy'),
Backbone=Alloy.Backbone,
_=Alloy._;




function __processArg(obj,key){
var arg=null;



return obj&&(arg=obj[key]||null),arg;
}

function Controller(){






















































































































































































































































































































function addBalancesBitcoin(balances){

var tableData=[];
1==pageBitcoin&&(

tokensSectionBitcoin=Ti.UI.createTableViewSection());


for(var i=0;i<balances.length;i++){
itemNumberBitcoin++;
var args={
id:itemNumberBitcoin,
token:balances[i].token,
balance:+balances[i].balance,
unconfirmedBalance:balances[i].unconfirmedBalance,
balanceFiat:'',
type:'bitcoin',
parent:$.bitcoinList},

tokenBox=Alloy.createController('component_token_box',args).getView(),

row=Ti.UI.createTableViewRow({
className:'token',
backgroundSelectedColor:'transparent',
rowIndex:i,
height:100});

row.add(tokenBox),

tokensSectionBitcoin.add(row);
}

tableData.push(tokensSectionBitcoin),
$.bitcoinList.data=tableData;
}

function addBalancesEthereum(balances){

var tableData=[];
1==pageEthereum&&(

tokensSectionEthereum=Ti.UI.createTableViewSection());


var userTokens={};
userTokens.ETH={name:'ETH'},

userTokens=Object.assign({},userTokens,ethereum.getTokens());


for(var tokenKeys=Object.keys(userTokens),i=0;i<tokenKeys.length;i++){
var aKey=tokenKeys[i],
args={
type:'ethereum',
contractAddress:aKey,
id:i,
token:userTokens[aKey].name,
balance:-1,
unconfirmedBalance:-1,
balanceFiat:'',
parent:$.ethereumList},

tokenBox=Alloy.createController('component_token_box',args).getView(),
row=Ti.UI.createTableViewRow({
className:'token',
backgroundSelectedColor:'transparent',
rowIndex:balances.length+i-1,
height:100});

row.add(tokenBox),
tokensSectionEthereum.add(row);
}

tableData.push(tokensSectionEthereum),
$.ethereumList.data=tableData;
}

function loadBitcoinBalance(hideLoading){

null!=loadingRequestBitcoin,




isLoadingBitcoin=!0,
!1==hideLoading&&
$.activityIndicatorBitcoin.show(),


loadingRequest=blockchain.API.getBalances({
chain:'bitcoin',
page:pageBitcoin,
per_page:perPageBitcoin,
callback:function(balances){
1==pageBitcoin&&hideLoading&&
$.bitcoinList.setData([]),


addBalancesBitcoin(balances);
},
onError:function(error){
void 0==error.message&&(
error=error.error),

util.createDialog({
title:error.type,
message:error.message,
buttonNames:[L('label_close')]}).
show(),
1!=pageBitcoin&&
pageBitcoin--,

$.errorMessageBitcoin.show();
},
always:function(){

$.activityIndicatorBitcoin.hide(),
controlBitcoin.endRefreshing(),
$.tableViewFooterBitcoin.visible=!1,
isLoadingBitcoin=!1;
}});

}

function loadEthereumBalance(hideLoading){

null!=loadingRequestEthereum,




$.activityIndicatorEthereum.hide(),
addBalancesEthereum([]),
setTimeout(function(){
controlEthereum.endRefreshing();
},700);
}

function refreshTokens(){
pageBitcoin=1,
itemNumberBitcoin=0,
isLoadingBitcoin||

loadBitcoinBalance(!1),


pageEthereum=1,
itemNumberEthereum=0,


loadEthereumBalance(!1);

}if(require('/alloy/controllers/BaseController').apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath='balances',this.args=arguments[0]||{},arguments[0])var __parentSymbol=__processArg(arguments[0],'__parentSymbol'),$model=__processArg(arguments[0],'$model'),__itemTemplate=__processArg(arguments[0],'__itemTemplate');var $=this,exports={},__defers={};$.__views.chainBar=Ti.UI.createView({width:'100%',height:40,top:Alloy.Globals.tabBarHeight,backgroundColor:'#f3f3f3',id:'chainBar'}),$.__views.chainBar&&$.addTopLevelView($.__views.chainBar),$.__views.tabCounterparty=Ti.UI.createView({width:'50%',left:0,id:'tabCounterparty',layout:'vertical'}),$.__views.chainBar.add($.__views.tabCounterparty),$.__views.tabCounterpartyButton=Ti.UI.createLabel({width:Ti.UI.SIZE,height:'100%',color:'#000000',font:{fontFamily:'HelveticaNeue-Light',fontSize:18,fontWeight:'normal'},text:'Counterparty',id:'tabCounterpartyButton'}),$.__views.tabCounterparty.add($.__views.tabCounterpartyButton),$.__views.tabEthereum=Ti.UI.createView({width:'50%',right:0,id:'tabEthereum',layout:'vertical'}),$.__views.chainBar.add($.__views.tabEthereum),$.__views.tabEthereumButton=Ti.UI.createLabel({width:Ti.UI.SIZE,height:'100%',color:'#000000',font:{fontFamily:'HelveticaNeue-Light',fontSize:18,fontWeight:'normal'},text:'Ethereum',id:'tabEthereumButton'}),$.__views.tabEthereum.add($.__views.tabEthereumButton),$.__views.tableViewFooterBitcoin=Ti.UI.createView({height:50,width:Ti.UI.FILL,id:'tableViewFooterBitcoin',visible:!1}),$.__views.__alloyId15=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.SIZE,layout:'horizontal',id:'__alloyId15'}),$.__views.tableViewFooterBitcoin.add($.__views.__alloyId15),$.__views.__alloyId16=Ti.UI.createActivityIndicator({style:Ti.UI.ActivityIndicatorStyle.DARK,visible:!0,id:'__alloyId16'}),$.__views.__alloyId15.add($.__views.__alloyId16),$.__views.__alloyId17=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'gray',font:{fontFamily:'HelveticaNeue-Light',fontSize:18,fontWeight:'normal'},left:5,text:L('label_loading'),id:'__alloyId17'}),$.__views.__alloyId15.add($.__views.__alloyId17),$.__views.bitcoinList=Ti.UI.createTableView({width:Ti.UI.FILL,height:0,top:60,backgroundColor:'#ececec',separatorStyle:Titanium.UI.TABLE_VIEW_SEPARATOR_STYLE_NONE,selectionStyle:Titanium.UI.iOS.TableViewCellSelectionStyle.NONE,footerView:$.__views.tableViewFooterBitcoin,id:'bitcoinList'}),$.__views.bitcoinList&&$.addTopLevelView($.__views.bitcoinList),$.__views.tableViewFooterEthereum=Ti.UI.createView({height:50,width:Ti.UI.FILL,id:'tableViewFooterEthereum',visible:!1}),$.__views.__alloyId19=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.SIZE,layout:'horizontal',id:'__alloyId19'}),$.__views.tableViewFooterEthereum.add($.__views.__alloyId19),$.__views.__alloyId20=Ti.UI.createActivityIndicator({style:Ti.UI.ActivityIndicatorStyle.DARK,visible:!0,id:'__alloyId20'}),$.__views.__alloyId19.add($.__views.__alloyId20),$.__views.__alloyId21=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'gray',font:{fontFamily:'HelveticaNeue-Light',fontSize:18,fontWeight:'normal'},left:5,text:L('label_loading'),id:'__alloyId21'}),$.__views.__alloyId19.add($.__views.__alloyId21),$.__views.ethereumList=Ti.UI.createTableView({width:Ti.UI.FILL,height:0,top:60,backgroundColor:'#ececec',separatorStyle:Titanium.UI.TABLE_VIEW_SEPARATOR_STYLE_NONE,selectionStyle:Titanium.UI.iOS.TableViewCellSelectionStyle.NONE,footerView:$.__views.tableViewFooterEthereum,id:'ethereumList',visible:!1}),$.__views.ethereumList&&$.addTopLevelView($.__views.ethereumList),$.__views.errorMessageBitcoin=Ti.UI.createView({width:Ti.UI.FILL,height:60,color:'#ffffff',backgroundColor:Alloy.Globals.mainColor,id:'errorMessageBitcoin',visible:!1}),$.__views.errorMessageBitcoin&&$.addTopLevelView($.__views.errorMessageBitcoin),$.__views.__alloyId22=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#929292',font:{fontFamily:'HelveticaNeue-Light',fontSize:15,fontWeight:'normal'},textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,text:L('label_error_loading'),id:'__alloyId22'}),$.__views.errorMessageBitcoin.add($.__views.__alloyId22),$.__views.errorMessageEthereum=Ti.UI.createView({width:Ti.UI.FILL,height:60,color:'#ffffff',backgroundColor:Alloy.Globals.mainColor,id:'errorMessageEthereum',visible:!1}),$.__views.errorMessageEthereum&&$.addTopLevelView($.__views.errorMessageEthereum),$.__views.__alloyId23=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#929292',font:{fontFamily:'HelveticaNeue-Light',fontSize:15,fontWeight:'normal'},textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER,text:L('label_error_loading'),id:'__alloyId23'}),$.__views.errorMessageEthereum.add($.__views.__alloyId23),$.__views.activityIndicatorBitcoin=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,backgroundColor:'#ffffff',opacity:0.5,id:'activityIndicatorBitcoin',visible:!1}),$.__views.activityIndicatorBitcoin&&$.addTopLevelView($.__views.activityIndicatorBitcoin),$.__views.__alloyId24=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.SIZE,layout:'horizontal',id:'__alloyId24'}),$.__views.activityIndicatorBitcoin.add($.__views.__alloyId24),$.__views.__alloyId25=Ti.UI.createActivityIndicator({style:Ti.UI.ActivityIndicatorStyle.DARK,visible:!0,id:'__alloyId25'}),$.__views.__alloyId24.add($.__views.__alloyId25),$.__views.loadingLabel=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#000000',font:{fontFamily:'HelveticaNeue-Light',fontSize:18,fontWeight:'normal'},left:5,text:L('label_loading'),id:'loadingLabel'}),$.__views.__alloyId24.add($.__views.loadingLabel),$.__views.activityIndicatorEthereum=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,backgroundColor:'#ffffff',opacity:0.5,id:'activityIndicatorEthereum',visible:!1}),$.__views.activityIndicatorEthereum&&$.addTopLevelView($.__views.activityIndicatorEthereum),$.__views.__alloyId26=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.SIZE,layout:'horizontal',id:'__alloyId26'}),$.__views.activityIndicatorEthereum.add($.__views.__alloyId26),$.__views.__alloyId27=Ti.UI.createActivityIndicator({style:Ti.UI.ActivityIndicatorStyle.DARK,visible:!0,id:'__alloyId27'}),$.__views.__alloyId26.add($.__views.__alloyId27),$.__views.loadingLabel=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#000000',font:{fontFamily:'HelveticaNeue-Light',fontSize:18,fontWeight:'normal'},left:5,text:L('label_loading'),id:'loadingLabel'}),$.__views.__alloyId26.add($.__views.loadingLabel),$.__views.tokenTopBar=Ti.UI.createView({width:Ti.UI.FILL,height:Alloy.Globals.topBarHeight,top:0,backgroundColor:Alloy.Globals.mainColor,id:'tokenTopBar'}),$.__views.tokenTopBar&&$.addTopLevelView($.__views.tokenTopBar),$.__views.settingsButton=Ti.UI.createImageView({left:10,width:30,bottom:10,id:'settingsButton',image:'/images/tookan.png'}),$.__views.tokenTopBar.add($.__views.settingsButton),$.__views.registerButton=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#929292',font:{fontFamily:'HelveticaNeue-Light',fontSize:15,fontWeight:'normal'},bottom:10,right:5,text:'register token',id:'registerButton'}),$.__views.tokenTopBar.add($.__views.registerButton),$.__views.__alloyId28=Ti.UI.createLabel(function(){var o={};return Alloy.deepExtend(!0,o,{width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#gray',font:{fontFamily:'HelveticaNeue-Light',fontSize:20,fontWeight:'normal'},top:28}),Alloy.Globals.isiPhoneX&&Alloy.deepExtend(!0,o,{top:38}),Alloy.deepExtend(!0,o,{text:L('label_tab_casa'),id:'__alloyId28'}),o}()),$.__views.tokenTopBar.add($.__views.__alloyId28),exports.destroy=function(){},_.extend($,$.__views);var cache=require('requires/cache'),util=require('requires/util'),network=require('requires/network'),blockchain=require('requires/blockchain'),bitcoin=require('requires/bitcoin'),ethereum=require('requires/ethereum'),isLoadingBitcoin=!1,loadingRequestBitcoin=null,isLoadingEthereum=!1,loadingRequestEthereum=null,itemNumberBitcoin=0,pageBitcoin=1,perPageBitcoin=25,tokensSectionBitcoin=null,itemNumberEthereum=0,pageEthereum=1,perPageEthereum=25,tokensSectionEthereum=null;$.registerButton.visible=!1,globals.loadedEthereumBalances=!1,$.settingsButton.addEventListener('touchend',function(){Alloy.createController('settings').getView()}),$.tabCounterparty.backgroundColor='rgba(0,0,0,0.2)';var tabColor='#f3f3f3';$.tabCounterparty.addEventListener('touchend',function(){$.registerButton.visible=!1,$.tabCounterparty.backgroundColor='rgba(0,0,0,0.2)',$.tabEthereum.backgroundColor=tabColor,$.bitcoinList.visible=!0,$.ethereumList.visible=!1,loadBitcoinBalance(!0)}),$.tabEthereum.addEventListener('touchend',function(){$.registerButton.visible=!0,$.tabEthereum.backgroundColor='rgba(0,0,0,0.2)',$.tabCounterparty.backgroundColor=tabColor,$.bitcoinList.visible=!1,$.ethereumList.visible=!0,!1==globals.loadedEthereumBalances&&(globals.loadedEthereumBalances=!0,loadEthereumBalance(!0))}),$.chainBar.top=Alloy.Globals.topBarHeight,$.bitcoinList.height=globals.display.height-(Alloy.Globals.tabBarHeight+Alloy.Globals.topBarHeight)-$.chainBar.height,$.bitcoinList.top=$.chainBar.height+$.chainBar.top,$.ethereumList.height=$.bitcoinList.height,$.ethereumList.top=$.bitcoinList.top,$.bitcoinList.addEventListener('scroll',function(e){if(!isLoadingBitcoin){if(loadMoreBitcoin=!1,!1)e.firstVisibleItem==e.totalItemCount-e.visibleItemCount&&(loadMoreBitcoin=!0);else if(!0){var offset=e.contentSize.height-e.contentOffset.y-$.bitcoinList.height;10>offset&&0<=offset&&(loadMoreBitcoin=!0)}!0==loadMoreBitcoin&&($.tableViewFooterBitcoin.visible=!0,pageBitcoin++,loadBitcoinBalance(!0),!0)}});var controlBitcoin=Ti.UI.createRefreshControl({tintColor:globals.currentColor});controlBitcoin.addEventListener('refreshstart',function(e){pageBitcoin=1,itemNumberBitcoin=1,loadBitcoinBalance(!0)}),$.bitcoinList.refreshControl=controlBitcoin,$.ethereumList.addEventListener('scroll',function(e){if(!isLoadingEthereum){if(loadMoreEthereum=!1,!1)e.firstVisibleItem==e.totalItemCount-e.visibleItemCount&&(loadMoreEthereum=!0);else if(!0){var offset=e.contentSize.height-e.contentOffset.y-$.ethereumList.height;10>offset&&0<=offset&&(loadMoreEthereum=!0)}!0==loadMoreEthereum&&($.tableViewFooterEthereum.visible=!0,pageEthereum++,loadEthereumBalance(!0),!0)}});var controlEthereum=Ti.UI.createRefreshControl({tintColor:globals.currentColor});controlEthereum.addEventListener('refreshstart',function(e){pageEthereum=1,itemNumberEthereum=1,loadEthereumBalance(!0)}),$.ethereumList.refreshControl=controlEthereum,
$.registerButton.addEventListener('click',function(){
Alloy.createController('add_token').getView();
}),

$.errorMessageBitcoin.addEventListener('touchend',function(){
$.errorMessageBitcoin.hide(),

loadBitcoinBalance(!1);
}),

$.errorMessageEthereum.addEventListener('touchend',function(){
$.errorMessageEthereum.hide(),

loadEthereumBalance(!1);
}),

$.activityIndicatorBitcoin.show(),

$.activityIndicatorEthereum.show(),

util.initialSetup(function(){

loadBitcoinBalance(!1),
loadEthereumBalance(!1);
}),

globals.refreshTokens=refreshTokens,









_.extend($,exports);
}

module.exports=Controller;