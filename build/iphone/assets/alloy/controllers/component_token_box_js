var Alloy=require('/alloy'),
Backbone=Alloy.Backbone,
_=Alloy._;




function __processArg(obj,key){
var arg=null;



return obj&&(arg=obj[key]||null),arg;
}

function Controller(){






















































































































































function showBalances(){
$.tokenBalance.text=args.balance.toFixed2(8),
$.tokenBalanceFiat.text=args.balanceFiat,
0!=args.unconfirmedBalance&&(
$.tokenBalanceUnconfirmed.visible=!0,
$.tokenBalanceUnconfirmed.text=args.unconfirmedBalance),


$.sendButton.visible=!0;
}












































function loadFiat(){
isFiatLoaded||(

'ethereum'==args.type?

'ETH'==args.token&&(

console.log('getting eth '+args.type+' '+args.token+' '+args.balance),
args.balanceFiat=tiker.to(args.type,args.token,args.balance,cache.data.currency),
console.log('getting eth '+args.balanceFiat),
$.tokenBalanceFiat.text=args.balanceFiat,
isFiatLoaded=!0):



'BTC'===args.token||'XCP'===args.token?(
'XCP'===args.token&&!isFinite(args.balance)&&globals.reorg_occured(),
args.balanceFiat=tiker.to(args.type,args.token,args.balance,cache.data.currency),
$.tokenBalanceFiat.text=args.balanceFiat,
isFiatLoaded=!0):

network.connectGET({
chain:'btc',
version:'v1',
method:'markets/'+args.token,
callback:function(result){

if(isFiatLoaded=!0,0<result.BTC.price){
var xcpval=result.BTC.price*args.balance;
$.tokenBalanceFiat.text=tiker.to(args.type,'BTC',xcpval,cache.data.currency,4);
}else
$.tokenBalanceFiat.text='-';

},
onError:function(error){
console.error(args.token,error);
}}));





}










function getBalance(){
if('ethereum'!=args.type)



























'bitcoin'==args.type&&(

loadFiat(),
showBalances());else if(!1==balanceLoaded){$.activityIndicator.show(),$.balances.visible=!1;var token=args.contractAddress;blockchain.API.getBalances({chain:'ethereum',contractAddress:token,callback:function(balances){balanceLoaded=!0,args.balance=parseFloat(balances.balance),args.unconfirmedBalance=balances.unconfirmedBalance,loadFiat(),showBalances()},onError:function(error){console.log(error),$.tokenBalance.text='error'},always:function(){$.activityIndicator.hide(),$.balances.visible=!0}})}

}if(require('/alloy/controllers/BaseController').apply(this,Array.prototype.slice.call(arguments)),this.__controllerPath='component_token_box',this.args=arguments[0]||{},arguments[0])var __parentSymbol=__processArg(arguments[0],'__parentSymbol'),$model=__processArg(arguments[0],'$model'),__itemTemplate=__processArg(arguments[0],'__itemTemplate');var $=this,exports={},__defers={};$.__views.component_token_box=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.SIZE,id:'component_token_box'}),$.__views.component_token_box&&$.addTopLevelView($.__views.component_token_box),$.__views.__alloyId41=Ti.UI.createView({top:8,right:8,width:'94%',height:90,borderRadius:20,backgroundColor:'rgba(0,0,0,0.05)',id:'__alloyId41'}),$.__views.component_token_box.add($.__views.__alloyId41),$.__views.tokenBox=Ti.UI.createView({width:'94%',borderRadius:20,height:90,top:5,padding:10,backgroundColor:'white',id:'tokenBox',postlayout:'getBalance'}),$.__views.component_token_box.add($.__views.tokenBox),$.__views.tokenImage=Ti.UI.createImageView({width:48,height:48,top:7,left:7,id:'tokenImage',defaultImage:'/images/image_blank.png'}),$.__views.tokenBox.add($.__views.tokenImage),$.__views.tokenName=Ti.UI.createLabel({width:150,height:Ti.UI.SIZE,color:'#000000',font:{fontFamily:'HelveticaNeue-Light',fontSize:18,fontWeight:'normal'},top:10,left:65,textAlign:'left',id:'tokenName'}),$.__views.tokenBox.add($.__views.tokenName),$.__views.__alloyId42=Ti.UI.createView({id:'__alloyId42'}),$.__views.tokenBox.add($.__views.__alloyId42),$.__views.balances=Ti.UI.createView({width:150,top:10,right:10,id:'balances',layout:'vertical'}),$.__views.__alloyId42.add($.__views.balances),$.__views.__alloyId43=Ti.UI.createView({width:Ti.UI.SIZE,height:Ti.UI.SIZE,right:0,layout:'horizontal',id:'__alloyId43'}),$.__views.balances.add($.__views.__alloyId43),$.__views.tokenBalance=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#000000',font:{fontFamily:'HelveticaNeue-Light',fontSize:18,fontWeight:'normal'},right:0,top:0,id:'tokenBalance'}),$.__views.__alloyId43.add($.__views.tokenBalance),$.__views.tokenBalanceUnconfirmed=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#000000',font:{fontFamily:'HelveticaNeue-Light',fontSize:10,fontWeight:'normal'},bottom:0,id:'tokenBalanceUnconfirmed',visible:!1}),$.__views.__alloyId43.add($.__views.tokenBalanceUnconfirmed),$.__views.tokenBalanceFiat=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#000000',font:{fontFamily:'HelveticaNeue-Light',fontSize:12,fontWeight:'normal'},right:0,top:1,id:'tokenBalanceFiat'}),$.__views.balances.add($.__views.tokenBalanceFiat),$.__views.activityIndicator=Ti.UI.createActivityIndicator({right:10,top:15,style:Ti.UI.ActivityIndicatorStyle.DARK,id:'activityIndicator',message:''}),$.__views.__alloyId42.add($.__views.activityIndicator),$.__views.infoButton=Ti.UI.createView({width:60,height:60,left:45,top:20,id:'infoButton'}),$.__views.tokenBox.add($.__views.infoButton),$.__views.__alloyId44=Ti.UI.createImageView({width:25,height:25,image:'/images/icon_info.png',id:'__alloyId44'}),$.__views.infoButton.add($.__views.__alloyId44),$.__views.sendButton=Ti.UI.createView({width:Ti.UI.SIZE,height:50,right:10,bottom:-22,id:'sendButton',layout:'horizontal'}),$.__views.tokenBox.add($.__views.sendButton),$.__views.__alloyId45=Ti.UI.createImageView({width:18,height:18,image:'/images/icon_send.png',id:'__alloyId45'}),$.__views.sendButton.add($.__views.__alloyId45),$.__views.__alloyId46=Ti.UI.createLabel({width:Ti.UI.SIZE,height:Ti.UI.SIZE,color:'#929292',font:{fontFamily:'HelveticaNeue-Light',fontSize:15,fontWeight:'normal'},left:5,textAlign:'center',text:L('label_send'),id:'__alloyId46'}),$.__views.sendButton.add($.__views.__alloyId46),exports.destroy=function(){},_.extend($,$.__views);var args=arguments[0]||{},blockchain=require('requires/blockchain'),network=require('requires/network'),cache=require('requires/cache'),tiker=require('requires/tiker'),ethereum=require('requires/ethereum'),balanceLoaded=!1;$.activityIndicator.hide(),$.balances.visible=!0,$.sendButton.visible=!1,$.tokenBox.addEventListener('postlayout',function(e){getBalance()}),!1,'ethereum'==args.type&&'ETH'!==args.token&&$.tokenBox.addEventListener('swipe',function(e){if('left'==e.direction){var slide=Ti.UI.createAnimation({left:-70,duration:200});$.tokenBox.animate(slide)}if('right'==e.direction){var slide=Ti.UI.createAnimation({left:0,duration:200});$.tokenBox.animate(slide)}}),$.tokenName.text=13<=args.token.length?args.token.substr(0,13)+'...':args.token,'ethereum'==args.type?'ETH'===args.token?$.tokenImage.image='/images/asset_eth.png':(console.log(Alloy.CFG.api_uri+'eth/v1/tokens/'+args.contractAddress+'/image?width=100&X-Api-Key='+Alloy.Globals.api_key),$.tokenImage.image=Alloy.CFG.api_uri+'eth/v1/tokens/'+args.contractAddress+'/image?width=100&X-Api-Key='+Alloy.Globals.api_key):'bitcoin'==args.type&&('BTC'===args.token?$.tokenImage.image='/images/asset_btc.png':'XCP'===args.token?$.tokenImage.image='/images/asset_xcp.png':$.tokenImage.image=Alloy.CFG.api_uri+'btc/v1/tokens/'+args.token+'/image?width=100&X-Api-Key='+Alloy.Globals.api_key),'ethereum'==args.type?'ETH'===args.token?$.infoButton.visible=!1:globals.addButtonEvent($.infoButton,function(e){Titanium.Platform.openURL('https://etherscan.io/token/'+args.contractAddress)}):'bitcoin'==args.type&&('BTC'===args.token||'XCP'===args.token?$.infoButton.visible=!1:globals.addButtonEvent($.infoButton,function(e){Titanium.Platform.openURL('walletapp.indiesquare.me/explorer/#/tokens/'+args.token)}));var isFiatLoaded=!1;globals.addButtonEvent($.sendButton,function(e){Alloy.createController('send',{token:args.token,balance:args.balance,contractAddress:args.contractAddress}).getView()}),









_.extend($,exports);
}

module.exports=Controller;