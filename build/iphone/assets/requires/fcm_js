module.exports=function(){
var self={},

cache=require("requires/cache"),
util=require("requires/util"),
network=require("requires/network");























































































return self.start=function(callback){function receivePush(e){try{var message;message=0?e.message:e.data.aps.alert,util.createDialog({message:message,buttonNames:[L("label_close")]}).show()}catch(e){globals.console.info("Push receive error.")}}function deviceTokenSuccess(e){deviceToken=e.deviceToken,network.connectPOST({chain:"btc",version:"v1",method:"devices",post:{user_id:cache.data.id,device_token:deviceToken,appver:Ti.App.version,language:L("language")},callback:function(result){console.log("success device register"),console.log(result),globals.deviceToken=deviceToken,callback(!0)},onError:function(error){util.createDialog({title:error.type,message:error.message,buttonNames:[L("label_close")]}).show(),callback(!1)}})}function deviceTokenError(e){globals.console.info("Failed to register for push notifications! "+e.error),callback(!1)}var deviceToken=null;if(!0)8<=parseInt(Ti.Platform.version.split(".")[0])?(Ti.App.iOS.addEventListener("usernotificationsettings",function registerForPush(){Ti.App.iOS.removeEventListener("usernotificationsettings",registerForPush),Ti.Network.registerForPushNotifications({success:deviceTokenSuccess,error:deviceTokenError,callback:receivePush})}),Ti.App.iOS.registerUserNotificationSettings({types:[Ti.App.iOS.USER_NOTIFICATION_TYPE_ALERT,Ti.App.iOS.USER_NOTIFICATION_TYPE_SOUND,Ti.App.iOS.USER_NOTIFICATION_TYPE_BADGE]}),Alloy.CFG.isLocal&&deviceTokenSuccess({deviceToken:"f9572370df5e3b2350dacca4023b73c2688265083b7eb1d1de325e2654f2c1e2"})):Ti.Network.registerForPushNotifications({types:[Ti.Network.NOTIFICATION_TYPE_BADGE,Ti.Network.NOTIFICATION_TYPE_ALERT,Ti.Network.NOTIFICATION_TYPE_SOUND],success:deviceTokenSuccess,error:deviceTokenError,callback:receivePush});else if(!Alloy.CFG.isDevelopment){var firebase=require("ti.firebase");firebase.registerForFCM({success:deviceTokenSuccess,error:deviceTokenError,callback:receivePush})}},self;
}();