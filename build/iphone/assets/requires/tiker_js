module.exports=function(){































function addCommas(nStr){
nStr+="",
x=nStr.split("."),
x1=x[0],
x2=1<x.length?"."+x[1]:"";for(
var rgx=/(\d+)(\d{3})/;
rgx.test(x1);)
x1=x1.replace(rgx,"$1,$2");

return x1+x2;
}var self={},blockchain=require("requires/blockchain"),network=require("requires/network");




























































































return self.getTiker=function(callback){globals.tiker={BTC:{},ETH:{}},network.connectGET({chain:"btc",version:"v1",method:"markets/btc",callback:function(tiker){globals.tiker.BTC=tiker,network.connectGET({chain:"btc",version:"v1",method:"markets/eth",callback:function(tiker){globals.tiker.ETH=tiker,null!=callback&&callback(tiker)},onError:function(error){}})},onError:function(error){}})},self.getFiatValue=function(chain,type,currency){var chainName="BTC";return chain==blockchain.ETHEREUM&&(chainName="ETH"),self.isAvailable(chain,currency)?globals.tiker[chainName][currency].last:null},self.getFiatSymbol=function(chain,currency){var chainName="BTC";return chain==blockchain.ETHEREUM&&(chainName="ETH"),self.isAvailable(chain,currency)?globals.tiker[chainName][currency].symbol:null},self.to=function(chain,type,quantity,currency,digit){var chainName="BTC";if(chain==blockchain.ETHEREUM&&(chainName="ETH"),!self.isAvailable(chain,currency))return null;if(!isFinite(quantity))return"???";var price=globals.tiker[chainName][currency].last,symbol=globals.tiker[chainName][currency].symbol;if(null==digit&&(digit=4),globals.tiker[chainName].hasOwnProperty(type)){var val=globals.tiker[chainName][type].last;return"{0}{1}".format(symbol,addCommas((quantity*price).toFixed2(digit)))}return"BTC"===type||"ETH"===type?"{0}{1}".format(symbol,addCommas((quantity*price).toFixed2(digit))):""},self.swapCurrency=function(params){var chainName="BTC";if(params.chain==blockchain.ETHEREUM&&(chainName="ETH"),!self.isAvailable(params.chain,params.from))return null;if(!self.isAvailable(params.chain,params.to))return null;var BTC=params.amount/globals.tiker[chainName][params.from].last,rate_to=globals.tiker[chainName][params.to].last;return(rate_to*BTC).toFixed2(4)},self.getRate=function(chain,currency){var chainName="BTC";if(chain==blockchain.ETHEREUM&&(chainName="ETH"),!self.isAvailable(chain,currency))return null;var xcp_btc=globals.tiker[chainName].XCP.last;return globals.tiker[chainName][currency].last*xcp_btc},self.isAvailable=function(chain,currency){var chainName="BTC";return chain==blockchain.ETHEREUM&&(chainName="ETH"),null!=globals.tiker&&currency in globals.tiker[chainName]},self;
}();