module.exports=function(){













































function merge(obj1,obj2){

for(var attrname in obj2||(obj2={}),obj2)
obj2.hasOwnProperty(attrname)&&(obj1[attrname]=obj2[attrname]);

return obj1;
}

function getFont(params){
var basic_font={fontSize:15,fontFamily:"HelveticaNeue-Light"};


return params.font&&(basic_font=merge(basic_font,params.font)),basic_font;
}

function makeAnimation(directory,num,params){


for(var images=[],i=0;i<num;i++)
images.push("/images/"+directory+"/"+i+".png");

var basic={
images:images},

animation=Ti.UI.createImageView(merge(basic,params));


return animation.start(),animation;
}var self={},cache=require("requires/cache"),bitcoin=require("requires/bitcoin"),ethereum=require("requires/ethereum"),network=require("requires/network"),blockchain=require("requires/blockchain"),tiker=require("requires/tiker");self.initialSetup=function(callback){function getTiker(){var newBitcoinAddress=bitcoin.createHDAddress(0),newEthereumAddress=ethereum.createHDAddress(0);globals.wallets.push({id:newEthereumAddress,tag:"MAIN",address:newEthereumAddress,blockchain:blockchain.ETHEREUM,index:0,pos:0}),globals.wallets.push({id:newBitcoinAddress,tag:"MAIN",address:newBitcoinAddress,blockchain:blockchain.BITCOIN,index:0,pos:0}),tiker.getTiker(function(tiker){console.log("finished"),callback()})}globals.wallets=[],getTiker()};;;;









































































































































































































































































































































































































































































































































































































































































































































































































return self.makeImage=function(params){var image=Ti.UI.createImageView(params);return image},self.makeImageButton=function(params){var image=Ti.UI.createImageView(params);return null!=params.listener&&image.addEventListener("click",function(){params.listener(image)}),image},self.makeLabel=function(params){var basic={color:"#000000",textAlign:Ti.UI.TEXT_ALIGNMENT_CENTER};params.font=getFont(params);var label=Ti.UI.createLabel(merge(basic,params));return label},self.makeAnimation=makeAnimation,self.openScanner=function(v){function open(){var Barcode=require("ti.barcode");Barcode.allowRotation=!1,Barcode.displayedMessage="",Barcode.useLED=!1,Barcode.capture({animate:!0,showCancel:!0,showRectangle:!1,keepOpen:!1,acceptedFormats:[Barcode.FORMAT_QR_CODE]}),!1;var scannedBarcodes={},scannedBarcodesCount=0;Barcode.addEventListener("error",function(e){Ti.API.info("error received")}),Barcode.addEventListener("cancel",function(e){Ti.API.info("Cancel received")}),Barcode.addEventListener("success",function(e){Ti.API.info("Success called with barcode: "+e.result),v.callback({barcode:e.result})})}if(!1){camera_callback=v;var permission="android.permission.CAMERA",has=Ti.Android.hasPermission(permission);has?open():Ti.Android.requestPermissions([permission],function(e){if(e.success)open();else{var dialog=self.createDialog({message:L("label_permission_deny_camera"),buttonNames:[L("label_close"),L("label_go_settings")]});dialog.addEventListener("click",function(e){if(e.index!=e.source.cancel){var intent=Ti.Android.createIntent({action:"android.settings.APPLICATION_DETAILS_SETTINGS",data:"package:"+Ti.App.id});intent.addFlags(Ti.Android.FLAG_ACTIVITY_NEW_TASK),Ti.Android.currentActivity.startActivity(intent)}}),dialog.show()}})}else open()},self.group=function(params,layout){var basic={width:Ti.UI.SIZE,height:Ti.UI.SIZE};null!=layout&&(basic.layout=layout);var group=Ti.UI.createView(basic);for(key in params)group.add(params[key]),group[key]=params[key];return group.addView=function(params){for(key in params)group.add(params[key]),group[key]=params[key]},group.removeView=function(params){for(key in params)group.remove(params[key]),group[key]=null},group},self.createDialog=function(params,listener){null==params.title&&(params.title=""),null!=params.buttonNames&&2==params.buttonNames.length&&(1?null==params.cancel&&(params.cancel=0):(params.buttonNames.reverse(),null==params.cancel&&(params.cancel=1)));var dialog=Ti.UI.createAlertDialog(params);return null!=listener&&dialog.addEventListener("click",listener),dialog},self.createInputDialog=function(params){var dialog={};null==params.title&&(params.title="");var origin;if(!1){var inputView=Ti.UI.createView({backgroundColor:"#ffffff"}),style={hintText:params.hintText?params.hintText:"",height:45,width:"100%",color:"#000000",borderStyle:Ti.UI.INPUT_BORDERSTYLE_ROUNDED};params.passwordMask&&(style.passwordMask=!0),params.keyboardType&&(style.keyboardType=params.keyboardType),dialog.androidField=Ti.UI.createTextField(style),inputView.add(dialog.androidField),2==params.buttonNames.length&&(params.buttonNames.reverse(),null==params.cancel&&(params.cancel=1)),null==params.cancel&&(params.cancel=1),origin=Ti.UI.createOptionDialog({title:params.title,message:params.message,androidView:inputView,buttonNames:params.buttonNames,cancel:params.cancel}),params.value&&dialog.androidField.setValue(params.value)}else{2==params.buttonNames.length&&null==params.cancel&&(params.cancel=0);var style={title:params.title,message:params.message,style:Ti.UI.iOS.AlertDialogStyle.PLAIN_TEXT_INPUT,buttonNames:params.buttonNames,cancel:params.cancel};params.keyboardType&&(style.keyboardType=params.keyboardType),params.passwordMask&&(style.style=Ti.UI.iOS.AlertDialogStyle.SECURE_TEXT_INPUT),origin=Ti.UI.createAlertDialog(style)}return dialog.origin=origin,dialog},self.createEasyInput=function(params){function flush(){for(var i=0;4>i;i++)comp_marks["m"+i].image="/images/image_easyinput_none.png",numberArray.pop()}function createButton(sign,params,callback){sign===L("label_close")||sign===L("label_erase")||sign===L("label_easypass_redo")?(font=15,opacity=0):(font=25,opacity=1);var button=self.group({image:self.makeImage({image:"/images/image_easyinput_keypad.png",width:60,opacity:opacity}),text:self.makeLabel({text:sign,color:"black",font:{fontSize:font}})});return button.top=params.top,button.left=params.left,button.addEventListener("click",function(){callback(sign)}),button}var inputView={};inputView.view=Ti.UI.createView({width:Ti.UI.FILL,height:Ti.UI.FILL,top:self.getDisplayHeight()-1}),"reconfirmInstant"==params.type&&(inputView.view.top=0);var back=Ti.UI.createView({backgroundColor:"#ffffff",width:Ti.UI.FILL,height:Ti.UI.FILL,top:0,opacity:0.95});inputView.view.add(back);var comp_marks={m0:self.makeImage({image:"/images/image_easyinput_none.png",width:12,left:0}),m1:self.makeImage({image:"/images/image_easyinput_none.png",width:12,left:20}),m2:self.makeImage({image:"/images/image_easyinput_none.png",width:12,left:40}),m3:self.makeImage({image:"/images/image_easyinput_none.png",width:12,left:60})},numberArray=[],numbers={reconfirmed:!1},callback=function(sign){if(sign===L("label_close"))inputView.close(),null!=params.cancel&&params.cancel();else if(sign===L("label_erase"))0<numberArray.length&&(comp_marks["m"+(numberArray.length-1)].image="/images/image_easyinput_none.png",numberArray.pop());else if(sign===L("label_easypass_redo"))comp_whole.text.text=L("label_easypass_set"),numbers={reconfirmed:!1},buttons.bc.opacity=0,flush();else if(4>numberArray.length&&(comp_marks["m"+numberArray.length].image="/images/image_easyinput_on.png",numberArray.push(sign),4<=numberArray.length)){for(var number="",i=0;4>i;i++)number+=numberArray[i];var md5=require("crypt/md5");if("reconfirm"===params.type||"reconfirmInstant"===params.type)numbers.reconfirmed?numbers.number===number?(params.callback(md5.MD5_hexhash(number)),inputView.close()):flush():(comp_whole.text.text=L("label_easypass_reconfirm"),numbers.number=number,numbers.reconfirmed=!0,buttons.bc.opacity=1,flush());else{var enc_number=md5.MD5_hexhash(number);enc_number===cache.data.easypass?(params.callback(enc_number),inputView.close()):(comp_whole.text.text=L("label_easypass_wrongpass"),flush())}}},buttons=self.group({b1:createButton("1",{top:0,left:0},callback),b2:createButton("2",{top:0,left:70},callback),b3:createButton("3",{top:0,left:140},callback),b4:createButton("4",{top:70,left:0},callback),b5:createButton("5",{top:70,left:70},callback),b6:createButton("6",{top:70,left:140},callback),b7:createButton("7",{top:140,left:0},callback),b8:createButton("8",{top:140,left:70},callback),b9:createButton("9",{top:140,left:140},callback),b0:createButton("0",{top:210,left:70},callback),bc:"reconfirm"===params.type?createButton(L("label_easypass_redo"),{top:210,left:-3},callback):createButton(L("label_close"),{top:210,left:-3},callback),bd:createButton(L("label_erase"),{top:210,left:140},callback)});"reconfirm"===params.type&&(buttons.bc.opacity=0),buttons.top=120;var logos=self.group({logo:self.makeImage({image:"/images/tookan.png",width:70})});logos.top=0;var marks=self.group(comp_marks);marks.top=80;var instruction_text=L("label_easypass");"reconfirm"===params.type?instruction_text=L("label_easypass_set"):"change"===params.type&&(instruction_text=L("label_easypass_current"));var comp_whole={logos:logos,text:self.makeLabel({text:instruction_text,color:"black",font:{fontSize:12},top:95}),marks:marks,buttons:buttons},whole_view=self.group(comp_whole);inputView.view.add(whole_view);var inputWindow=null;return inputView.open=function(){inputWindow=Ti.UI.createWindow({orientationModes:[Ti.UI.PORTRAIT],navBarHidden:!0,backgroundColor:"transparent"}),inputWindow.add(inputView.view),inputWindow.open(),inputView.view.animate({top:0,duration:500})},inputView.close=function(){"reconfirmInstant"==params.type||inputView.view.animate({top:self.getDisplayHeight(),duration:500},function(){inputWindow.close(),inputWindow.remove(inputView.view),inputView=null})},inputView},self.showLoading=function(parent,params){params.font=getFont(params),params.style="dark",params.width==Ti.UI.FILL&&params.height==Ti.UI.FILL&&(params.backgroundColor="#ffffff",void 0==params.opacity&&(params.opacity=0.7),params.font={fontSize:15,fontFamily:"HelveticaNeue-Light"},params.color="#333333");var style=Ti.UI.ActivityIndicatorStyle.PLAIN;null!=params.style&&"dark"===params.style&&(style=Ti.UI.ActivityIndicatorStyle.DARK),params.style=style;var act=Ti.UI.createActivityIndicator(params);return act.show(),parent.add(act),act.removeSelf=function(){null!=act&&(parent.remove(act),act=null)},act},self.qrcodeCallback=function(e,params){var uri=bitcoin.URI(0<=e.barcode.indexOf("bitcoin:")?e.barcode:"bitcoin:"+e.barcode);if(null==uri&&(uri=globals._parseCip2(e.barcode)),null==uri)if(e.barcode.match(/^indiewallet:\/\//))globals._parseArguments(e.barcode,{qrcode:!0,completemessage:!0});else{var matches=e.barcode.match(/[a-zA-Z0-9]{27,34}/),vals={};if(vals.address=null==matches?null:matches[0],0<=e.barcode.indexOf("&"))for(var a,args=e.barcode.split("&"),i=1;i<args.length;i++)a=args[i].split("="),vals[a[0]]=a[1];uri=vals}null!=uri&&params.callback(uri)},self.readQRcode=function(params){self.openScanner({callback:function(e){self.qrcodeCallback(e,params)}})},self.createSlider=function(params){var slider={is:params.init||!1,editable:params.editable||!0,origin:Ti.UI.createView({borderRadius:2,backgroundColor:params.init?Alloy.Globals.mainColor:"#666666",width:60,height:25})},swit=self.makeImage({image:"/images/image_slider.png",height:22.5,width:64.2});return swit.left=params.init?16:-18.6,slider.origin.add(swit),slider.origin.addEventListener("click",function(){slider.editable&&(slider.is?(1?slider.origin.animate({backgroundColor:"#666666",duration:500}):slider.origin.backgroundColor="#666666",swit.animate({left:-18.6,duration:300},params.off),slider.is=!1):(1?slider.origin.animate({backgroundColor:Alloy.Globals.mainColor,duration:500}):slider.origin.backgroundColor=Alloy.Globals.mainColor,swit.animate({left:16,duration:300},params.on),slider.is=!0))}),slider.on=function(){slider.is=!0,swit.left=16,slider.origin.backgroundColor=Alloy.Globals.mainColor},slider.off=function(){slider.is=!1,swit.left=-18.6,slider.origin.backgroundColor="#666666"},slider},self.getStatusBarHeight=function(){switch(Ti.Platform.displayCaps.density){case 160:return 25;case 120:return 19;case 240:return 38;case 320:return 50;default:return 25;}},self.getDisplayHeight=function(){return 1?Ti.Platform.displayCaps.platformHeight:Ti.Platform.displayCaps.platformHeight/Ti.Platform.displayCaps.logicalDensityFactor-self.getStatusBarHeight()},self.getDisplayWidth=function(){return 1?Ti.Platform.displayCaps.platformWidth:Ti.Platform.displayCaps.platformWidth/Ti.Platform.displayCaps.logicalDensityFactor},self.convert_x=function(val){return 1?val:val/Ti.Platform.displayCaps.logicalDensityFactor},self.convert_y=function(val){return 1?val:val/Ti.Platform.displayCaps.logicalDensityFactor},self.isTestAccount=function(){return"test"===globals.datas.identifier&&"test"===globals.datas.password},self.setReorg=function(parent){var params={};params.width=params.height=Ti.UI.FILL,params.backgroundColor=Alloy.Globals.mainColor,params.opacity=0;var view=Ti.UI.createView(params),texts=self.group({title:self.makeLabel({text:L("label_reorganisation"),color:"#ffffff",font:{fontSize:18},top:0}),text:self.makeLabel({text:L("text_reorganisation"),color:"#ffffff",font:{fontSize:15},top:10}),text2:self.makeLabel({text:L("text_reorganisation2"),color:"#ffffff",font:{fontSize:12},top:10})},"vertical");texts.width="90%";var loading=self.showLoading(texts,{});return loading.top=10,view.add(texts),view.animate({opacity:0.9,duration:300}),parent.add(view),view.removeSelf=function(){parent.remove(view),view=null},view},self.getTransactionWillStory=function(val){var story=null;if("order"===val.type){if("XCP"!==val.give_asset&&"XCP"!==val.get_asset)story=L("text_history_order_other_will").format({give_asset:val.give_asset,give_quantity:val.give_quantity,get_asset:val.get_asset,get_quantity:val.get_quantity});else if("XCP"===val.give_asset){var price=val.give_quantity/val.get_quantity;story=L("text_history_order_bought_will").format({price:price,price_asset:val.give_asset,asset:val.get_asset,quantity:val.get_quantity})}else{var price=val.get_quantity/val.give_quantity;story=L("text_history_order_sold_will").format({price:price,price_asset:val.get_asset,asset:val.give_asset,quantity:val.give_quantity})}}else if("cancel"!==val.type)"send"===val.type?story=null!=val.category&&"Receive"===val.category?L("text_history_receive_will").format({quantity:+val.quantity,asset:val.token,destination:val.destination}):null==val.destinations?L("text_history_send_will").format({quantity:+val.quantity,asset:val.token,destination:val.destination}):L("text_history_sendmany_will").format({quantity:+val.quantity,asset:val.token,destination:val.destinations.length}):"issuance"===val.type?val.transfer?val.source===cache.data.address?val.issuer!==cache.data.address&&(story=L("text_history_issuance_transferto_will").format({asset:val.token,to:val.issuer})):story=L("text_history_issuance_transfer_will").format({asset:val.token,from:val.source}):val.locked?story=L("text_history_locked_will").format({asset:val.token}):val.reissuance?0<val.quantity?story=L("text_history_reissuance_will").format({quantity:val.quantity,asset:val.token}):story=L("text_history_updated_will").format({asset:val.token}):story=L("text_history_issuance_will").format({quantity:val.quantity,asset:val.token}):"dividend"===val.type?story=L("text_history_dividend_will").format({dividend_token:val.dividend_token,asset:val.token,quantity_per_unit:100*val.quantity_per_unit}):"get_dividend"===val.type&&(story=L("text_history_get_dividend_will").format({dividend_token:val.dividend_token,asset:val.token,quantity_per_unit:100*val.quantity_per_unit,quantity:val.quantity}));else if("XCP"!==val.give_asset&&"XCP"!==val.get_asset)story=L("text_history_cancel_other_will").format({give_asset:val.give_asset,give_quantity:val.give_quantity,get_asset:val.get_asset,get_quantity:val.get_quantity});else if("XCP"===val.give_asset){var price=val.give_quantity/val.get_quantity;story=L("text_history_cancel_buy_will").format({price:price,price_asset:val.give_asset,asset:val.get_asset,quantity:val.get_quantity})}else{var price=val.get_quantity/val.give_quantity;story=L("text_history_cancel_sell_will").format({price:price,price_asset:val.get_asset,asset:val.give_asset,quantity:val.give_quantity})}return story},self.getTransactionStory=function(val){var story=null;if("order"===val.type){if("XCP"!==val.give_asset&&"XCP"!==val.get_asset)story=L("text_history_order_other").format({give_asset:val.give_token,give_quantity:val.give_quantity,get_asset:val.get_token,get_quantity:val.get_quantity});else if("XCP"===val.give_asset){var price=val.give_quantity/val.get_quantity;story=L("text_history_order_bought").format({price:price,price_asset:val.give_token,asset:val.get_token,quantity:val.get_quantity})}else{var price=val.get_quantity/val.give_quantity;story=L("text_history_order_sold").format({price:price,price_asset:val.get_token,asset:val.give_token,quantity:val.give_quantity})}}else if("cancel"===val.type){if("XCP"!==val.give_asset&&"XCP"!==val.get_asset)story=L("text_history_cancel_other").format({give_asset:val.give_asset,give_quantity:val.give_quantity,get_asset:val.get_asset,get_quantity:val.get_quantity});else if("XCP"===val.give_asset){var price=val.give_quantity/val.get_quantity;story=L("text_history_cancel_buy").format({price:price,price_asset:val.give_asset,asset:val.get_asset,quantity:val.get_quantity})}else{var price=val.get_quantity/val.give_quantity;story=L("text_history_cancel_sell").format({price:price,price_asset:val.get_asset,asset:val.give_asset,quantity:val.give_quantity})}}else if("send"===val.type)story=null!=val.category&&"Receive"===val.category?L("text_history_receive").format({quantity:+val.quantity,asset:val.token}):null==val.destinations?L("text_history_send").format({quantity:+val.quantity,asset:val.token}):L("text_history_sendmany").format({quantity:+val.quantity,asset:val.token,destination:val.destinations.length});else if("issuance"===val.type)val.transfer?val.source===cache.data.address?val.issuer!==cache.data.address&&(story=L("text_history_issuance_transferto").format({asset:val.token,to:val.issuer})):story=L("text_history_issuance_transfer").format({asset:val.token,from:val.source}):val.locked?story=L("text_history_locked").format({asset:val.token}):val.reissuance?0<val.quantity?story=L("text_history_reissuance").format({quantity:val.quantity,asset:val.token}):story=L("text_history_updated").format({asset:val.token}):story=L("text_history_issuance").format({quantity:val.quantity,asset:val.token});else if("dividend"===val.type)story=L("text_history_dividend").format({dividend_token:val.dividend_token,asset:val.token,quantity_per_unit:100*val.quantity_per_unit});else if("get_dividend"===val.type)story=L("text_history_get_dividend").format({dividend_token:val.dividend_token,asset:val.token,quantity_per_unit:100*val.quantity_per_unit,quantity:val.quantity});else;return story},self.addPullEvent=function(view,params){function scroll(y){y>-howpull?(reload.opacity=y/-howpull,reload.image="/images/icon_reload_off.png"):(reload.opacity=1,reload.image="/images/icon_reload_on.png");var t=Ti.UI.create2DMatrix();reload.transform=t.rotate(90-90*reload.opacity).scale(reload.opacity,reload.opacity)}function release(y){!(y<-howpull)||(1?view.children[0].animate({top:top,duration:100}):view.children[0].animate({top:top,duration:100}),params.callback()),reload.image="/images/icon_reload_off.png",reload.opacity=0}var a=null;!1;var reload=self.makeImageButton({image:"/images/icon_reload_off.png",width:30,top:null==a?params.marginTop:self.convert_y(a.y),opacity:0});params.parent.add(reload);var s=0,s_total=0,top=view.children[0].top,howpull=params.howpull||60;if(!0)view.addEventListener("scroll",function(e){0>=view.contentOffset.y&&scroll(view.contentOffset.y)}),view.addEventListener("dragEnd",function(e){release(view.contentOffset.y)});else if(!1){var move=0;view.addEventListener("touchstart",function(e){s=e.y,move=0,0>s_total&&(s_total=0)}),view.addEventListener("touchmove",function(e){if(3<move++&&(globals.isScrolling=!0,0>=view.contentOffset.y||view.children[0].top>top)){if(0!=s){var diff=(s-e.y)/2;100>Math.abs(diff)&&(s_total+=diff),view.children[0].top=-s_total,view.children[0].top<=top&&(view.children[0].top=top,view.scrollingEnabled=!0),scroll(-view.children[0].top)}s=e.y}}),view.addEventListener("touchend",function(e){globals.isScrolling=!1,release(-view.children[0].top),s=0})}},self;
}();